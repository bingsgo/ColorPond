<!DOCTYPE html>
<html>
<head>

    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="css/index.css">

    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script src="js/randomseed.js"></script>
    <script src="js/pond.js"></script>
    <script src="js/draw.js"></script>
    <script src="js/helpers.js"></script>

    <title>ColorPond</title>
</head>
<body>
    <div style="" id="fps"></div>
    <h2>ColorPond</h2>
    <div id="pondHolder">
        <canvas id="pond" class="no_initial"></canvas>
        <div id="options">
            <div id="init" class="intial_only">
                <span class="item">Width: <input type="number" id="width" value="125"  min="1" max="9999" /></span>
                <span class="item">Height: <input type="number" id="height" value="125" min="1" max="9999" /></span>
                <span class="item">Total Area: <span id="totalarea"></span>
                <span class="item">Best Fit? <input type="checkbox" id="bestfit" checked="checked" /></span>
                <span class="item">Seed: <input type="text" style="width:50px;" id="seed" /><br>
                    <span style="font-size:10px;">(leave blank for random)</span></span>
                <button id="doinit">Go</button>
            </div>
            <span class="item no_initial"><button id="pauserun">Pause/Run</button></span>
            <span class="item">Update Rate: 1/<input id="bulkrate" type="number" min="1" max="100" /></span>
            <span class="item">Tick Wait: <input id="speed" type="number" min="10" max="5000" /></span>
            <span class="item">Filter: <select id="filter">
              <option value="none">None</option>
              <option value="sharpen" selected>Sharpen</option>
              <option value="blur">Blur</option>
              <option value="smooth">Neon Smooth</option>
            </select></span>
            <span class="item">Flow %: 1/<input id="flow" type="number" min="1" max="50" /></span>
            <span class="item">P Spawn %: 1/<input id="pro_life" type="number" min="1" max="500" /></span>
            <span class="item">C Spawn %: 1/<input id="con_life" type="number" min="1" max="500" /></span>
            <span class="item">Mutation %: 1/<input id="mutation" type="number" min="1" max="500" /></span>
            <span class="item">R Spawn %: 1/<input id="resourcespawn" type="number" min="1" max="500" /></span>
            <span class="item">Goal R %: /<input id="goalresouce" type="number" min="1" max="500" /></span>
            <span class="item">P Move %: /<input id="plantStartMoveChance" type="number" min="1" max="500" /></span>
            <span class="item">Cell Wall: <input id="cellwall" type="checkbox" /></span>
            <div id="info"></div>
        </div>
    </div>
    <script>
    $(document).ready(function(){
        $('#doinit').click(function(){
            if($('#seed').val() == '') Math.seedrandom();
            else Math.seedrandom($('#seed').val());
            pond.width = parseInt($('#width').val());
            pond.height = parseInt($('#height').val());
            if(pond.width*pond.height > 22500){
                conf = confirm('You have selected a LARGE map. This will almost certianly cause extreme lag. Press OK to continue, or cancel to change the size.');
                if(!conf) return;
            }
            pond.init();
            pond.render();
            $('#pondHolder').width(250 + $('#pond').width());
            $('.no_initial').show();
            $('.intial_only').hide();
        });
        $('.no_initial').hide();
        var tick = 10;
        running = false;
        $('#pauserun').click(function(){
            if(running){
                clearTimeout(r);
                running = false;
            }
            else{
                r = setTimeout(function(){
                    pond.step();
                    r = setTimeout(arguments.callee,tick)
                },tick);
                running = true;
            }
        });
        $('#singlebulk').click(function(){
            pond.singleRender = !pond.singleRender;
            if(pond.singleRender) $(this).text('Single Render');
            else                  $(this).text('Bulk Render');
        });
        $('#bulkrate').change(function(ev){
            pond.bulkOdd = parseInt($(this).val());
        });
        $('#speed').change(function(ev){
            tick = parseInt($(this).val());
        });
        $('#flow').change(function(ev){
            pond.flowChance = parseInt($(this).val());
        });
        $('#pro_life').change(function(ev){
            pond.producerSpawnChance = parseInt($(this).val());
        });
        $('#con_life').change(function(ev){
            pond.consumerSpawnChance = parseInt($(this).val());
        });
        $('#resourcespawn').change(function(ev){
            pond.resourceSpawnChance = parseInt($(this).val());
        });
        $('#goalresouce').change(function(ev){
            pond.resouceThreshold = parseInt($(this).val());
        });
        $('#plantStartMoveChance').change(function(ev){
            pond.plantStartMoveChance = parseInt($(this).val());
        });
        $('#mutation').change(function(ev){
            pond.mutationChance = parseInt($(this).val());
        });
        $('#filter').change(function(ev){
            draw.filter = $(this).val();
            pond.render();
        });
        $('#cellwall').click(function(){
            pond.cellWall = !pond.cellWall;
            if(pond.cellWall) $(this).attr('checked','checked');
            else              $(this).removeAttr('checked');
        });


        $('#bulkrate').val(pond.bulkOdd);
        $('#speed').val(tick);
        $('#flow').val(pond.flowChance);
        $('#mutation').val(pond.mutationChance);
        $('#filter').val(draw.filter);
        $('#pro_life').val(pond.producerSpawnChance);
        $('#con_life').val(pond.consumerSpawnChance);
        $('#resourcespawn').val(pond.resourceSpawnChance);
        $('#plantStartMoveChance').val(pond.plantStartMoveChance);
        $('#goalresouce').val(pond.resouceThreshold);
        $('#singlebulk').text(pond.singleRender?'Single Render':'Bulk Render');
        if(pond.cellWall){
            $('#cellwall').attr('checked','checked');
        }


        var screenX = $('html').width()-350;
        var screenY = $('html').height()-150;

        var ideal = 15625;
        if(screenX > screenY){
            var s1 = Math.round((screenX/screenY)*100)/100;
            var s2 = Math.floor(ideal/s1);
            var s3 = Math.floor(Math.sqrt(s2));
            var dx = Math.floor(s1*s3);
            var dy = s3;
        } else {
            var s1 = Math.round((screenY/screenX)*100)/100;
            var s2 = Math.floor(ideal/s1);
            var s3 = Math.floor(Math.sqrt(s2));
            var dy = Math.floor(s1*s3);
            var dx = s3;
        }

        $('#width').val(dx);
        $('#height').val(dy);

        $('#totalarea').text(parseInt($('#height').val())*parseInt($('#width').val()));

        var bestfit = true;

        $('#bestfit').click(function(){
            bestfit = !bestfit;
            if(bestfit) $(this).attr('checked','checked');
            else       $(this).removeAttr('checked');
        });

        $('#height').change(function(){
            if(bestfit){
                $('#width').val(Math.floor(dx*(parseInt($(this).val())/dy)));
            }
            $('#totalarea').text(parseInt($('#height').val())*parseInt($('#width').val()));
        });
        $('#width').change(function(){
            if(bestfit){
                $('#height').val(Math.floor(dy*(parseInt($(this).val())/dx)));
            }
            $('#totalarea').text(parseInt($('#height').val())*parseInt($('#width').val()));
        });
    });
</script>
</body>
</html>